{% load static %}
<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carte Interactive - Bassins de Production Cameroun</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Font Awesome (Free CDN officiel) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/carte.css' %}">

    <script>
        // Configuration Tailwind personnalisée - Thème Vert
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#16a34a',
                        secondary: '#15803d',
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-gradient-to-r from-green-600 to-green-700 text-white shadow-lg relative z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-map-marked-alt text-3xl"></i>
                    <div>
                        <h1 class="text-2xl font-bold">Plateforme SIG - Cameroun</h1>
                        <p class="text-green-100 text-sm">Bassins de Production Économique</p>
                    </div>
                </div>
                <nav class="flex space-x-4">
                    <a href="/" class="px-4 py-2 bg-white text-green-600 rounded-lg font-semibold">
                        <i class="fas fa-map mr-2"></i>Carte
                    </a>
                    <a href="/admin/" class="px-4 py-2 bg-green-700 rounded-lg hover:bg-green-600 transition">
                        <i class="fas fa-cog mr-2"></i>Admin
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content - Carte plein écran -->
    <div class="relative h-[calc(100vh-80px)]">
        <!-- Carte Centrale (plein écran) -->
        <div id="map" class="w-full h-full"></div>

        <!-- Loading Overlay -->
        <div id="loading" class="absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50 hidden">
            <div class="text-center">
                <i class="fas fa-spinner fa-spin text-5xl text-green-600 mb-4"></i>
                <p class="text-gray-700 font-semibold">Chargement des données...</p>
            </div>
        </div>

        <!-- Message d'absence de données -->
        <div id="no-data-message"
            class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white p-8 rounded-lg shadow-xl text-center hidden z-40">
            <i class="fas fa-info-circle text-6xl text-green-500 mb-4"></i>
            <h3 class="text-xl font-bold text-gray-800 mb-2">Aucune donnée disponible</h3>
            <p class="text-gray-600">Veuillez sélectionner des filtres et cliquer sur "Appliquer"</p>
        </div>

        <!-- Sidebar Gauche - Filtres (Overlay) -->
        <aside id="sidebar-left" class="w-80 bg-white overflow-y-auto">
            <!-- Barre d'icônes (visible quand rétracté) -->
            <div class="sidebar-icons">
                <div class="icon-item" title="Filtres">
                    <i class="fas fa-filter text-xl"></i>
                </div>
                <div class="icon-item" title="Secteur">
                    <i class="fas fa-layer-group text-xl"></i>
                </div>
                <div class="icon-item" title="Produit">
                    <i class="fas fa-seedling text-xl"></i>
                </div>
                <div class="icon-item" title="Année">
                    <i class="fas fa-calendar-alt text-xl"></i>
                </div>
                <div class="icon-item" title="Niveau">
                    <i class="fas fa-sitemap text-xl"></i>
                </div>
            </div>

            <!-- Contenu principal (visible quand déployé) -->
            <div class="sidebar-content p-6">
                <!-- Toggle Button -->
                <button id="toggle-left"
                    class="absolute -right-3 top-6 bg-green-600 text-white rounded-full w-8 h-8 flex items-center justify-center shadow-lg hover:bg-green-700 transition z-10">
                    <i class="fas fa-chevron-left"></i>
                </button>

                <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-filter mr-2 text-green-600"></i>
                    Filtres
                </h2>

                <form id="filter-form" class="space-y-5">
                    <!-- Secteur -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-layer-group mr-1 text-green-600"></i>
                            Secteur
                        </label>
                        <select id="secteur" name="secteur"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            <option value="">-- Sélectionner --</option>
                            <option value="agriculture">Agriculture</option>
                            <option value="elevage">Élevage</option>
                            <option value="peche">Pêche</option>
                        </select>
                    </div>

                    <!-- Produit -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-seedling mr-1 text-green-600"></i>
                            Produit
                        </label>
                        <select id="produit" name="produit"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                            disabled>
                            <option value="">-- Sélectionner un secteur d'abord --</option>
                        </select>
                    </div>

                    <!-- Année -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-calendar-alt mr-1 text-purple-600"></i>
                            Année
                        </label>
                        <select id="annee" name="annee"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            <option value="">-- Sélectionner --</option>
                        </select>
                    </div>

                    <!-- Niveau Administratif -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-sitemap mr-1 text-orange-600"></i>
                            Niveau Administratif
                        </label>
                        <select id="niveau" name="niveau"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            <option value="region">Région</option>
                            <option value="departement">Département</option>
                            <option value="arrondissement">Arrondissement</option>
                        </select>
                    </div>

                    <!-- Bouton Appliquer -->
                    <button type="submit"
                        class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition shadow-lg flex items-center justify-center">
                        <i class="fas fa-search mr-2"></i>
                        Appliquer les filtres
                    </button>

                    <!-- Bouton Réinitialiser -->
                    <button type="button" id="reset-filters"
                        class="w-full bg-gray-200 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-300 transition flex items-center justify-center">
                        <i class="fas fa-redo mr-2"></i>
                        Réinitialiser
                    </button>
                </form>

                <!-- Légende -->
                <div id="legend" class="mt-8 p-4 bg-gray-50 rounded-lg hidden">
                    <h3 class="text-sm font-bold text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-palette mr-2 text-green-600"></i>
                        Légende
                    </h3>
                    <div id="legend-content" class="space-y-2">
                        <!-- Généré dynamiquement par JS -->
                    </div>
                </div>
            </div>
        </aside>

        <!-- Sidebar Droite - Informations (Overlay) -->
        <aside id="sidebar-right" class="w-96 bg-white overflow-y-auto collapsed">
            <!-- Barre d'icônes (visible quand rétracté) -->
            <div class="sidebar-icons">
                <div class="icon-item" title="Informations">
                    <i class="fas fa-chart-bar text-xl"></i>
                </div>
                <div class="icon-item" title="Production">
                    <i class="fas fa-chart-line text-xl"></i>
                </div>
                <div class="icon-item" title="Zone dominante">
                    <i class="fas fa-trophy text-xl"></i>
                </div>
                <div class="icon-item" title="Statistiques">
                    <i class="fas fa-map-marker-alt text-xl"></i>
                </div>
            </div>

            <!-- Contenu principal (visible quand déployé) -->
            <div class="sidebar-content p-6">
                <!-- Toggle Button -->
                <button id="toggle-right"
                    class="absolute -left-3 top-6 bg-green-600 text-white rounded-full w-8 h-8 flex items-center justify-center shadow-lg hover:bg-green-700 transition z-10">
                    <i class="fas fa-chevron-right"></i>
                </button>

                <!-- Titre dynamique -->
                <div class="mb-6">
                    <h2 id="info-title" class="text-xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-chart-bar mr-2 text-green-600"></i>
                        Informations
                    </h2>
                    <p id="info-subtitle" class="text-sm text-gray-500 mt-1"></p>
                </div>

                <!-- Indicateurs synthétiques -->
                <div class="space-y-4 mb-6">
                    <div class="bg-gradient-to-r from-green-50 to-green-100 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Production Totale</p>
                                <p id="total-production" class="text-2xl font-bold text-green-600">-</p>
                            </div>
                            <i class="fas fa-chart-line text-3xl text-green-400"></i>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-emerald-50 to-emerald-100 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Zone Dominante</p>
                                <p id="zone-dominante" class="text-lg font-bold text-emerald-600">-</p>
                            </div>
                            <i class="fas fa-trophy text-3xl text-emerald-400"></i>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-teal-50 to-teal-100 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Zones avec données</p>
                                <p id="nombre-zones" class="text-2xl font-bold text-teal-600">-</p>
                            </div>
                            <i class="fas fa-map-marker-alt text-3xl text-teal-400"></i>
                        </div>
                    </div>
                </div>

                <!-- Détails de la zone sélectionnée -->
                <div id="zone-details" class="hidden">
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center border-t pt-4">
                        <i class="fas fa-info-circle mr-2 text-green-600"></i>
                        Zone Sélectionnée
                    </h3>
                    <div class="bg-gray-50 p-4 rounded-lg space-y-3">
                        <div>
                            <p class="text-xs text-gray-500 uppercase">Nom</p>
                            <p id="zone-nom" class="text-lg font-semibold text-gray-800">-</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 uppercase">Production</p>
                            <p id="zone-production" class="text-xl font-bold text-green-600">-</p>
                        </div>
                        <div id="zone-hierarchie" class="hidden">
                            <p class="text-xs text-gray-500 uppercase">Hiérarchie</p>
                            <p id="zone-hierarchie-text" class="text-sm text-gray-700">-</p>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Custom JS -->
    <script src="{% static 'js/carte.js' %}"></script>
</body>

</html>